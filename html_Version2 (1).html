<!doctype html>
<html lang="pt-BR" translate="no">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=yes, viewport-fit=cover" />
  <meta name="google" content="notranslate" />
  <meta http-equiv="Content-Language" content="pt-BR" />
  <meta name="locale" content="pt-BR" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
  <meta name="format-detection" content="telephone=no" />
  <meta name="mobile-web-app-capable" content="yes" />
  <title>FreiSa Hostel ‚Äî Reserva (v3)</title>

  <style>
    /* ==========================================================================
       Base / Reset
       ========================================================================== */
    :root{
      --accent:#27ae60;          /* green */
      --accent-600:#1e8449;
      --danger:#e74c3c;          /* red */
      --muted:#6b7280;
      --card:#ffffff;
      --bg:#f6f7f9;
      --max-width:1200px;
      --shadow: 0 8px 20px rgba(16,24,40,0.06);
    }
    *{box-sizing:border-box}
    html,body,#app{height:100%}
    body{
      font-family: Inter, "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
      margin:0; color:#111; background:var(--bg); -webkit-font-smoothing:antialiased;
      -moz-osx-font-smoothing:grayscale; -webkit-text-size-adjust:100%;
    }
    img{max-width:100%;display:block;height:auto}
    button{cursor:pointer;font:inherit}
    a{color:inherit;text-decoration:none}

    .container{max-width:var(--max-width);margin:0 auto;padding:0 16px}
    header{position:sticky;top:0;z-index:120;background:transparent;padding:12px 0}
    .topbar{display:flex;align-items:center;gap:12px}
    .brand{font-weight:700;font-size:1.05rem;color:var(--accent)}
    .spacer{flex:1}

    /* ==========================================================================
       HERO
       ========================================================================== */
    .hero{position:relative;height:78vh;min-height:420px;overflow:hidden;border-radius:12px;background:#000;box-shadow:0 8px 30px rgba(0,0,0,0.12)}
    .hero-slide{position:absolute;inset:0;background-size:cover;background-position:center;opacity:0;transition:opacity 1.25s}
    .hero-slide.active{opacity:1}
    .hero-overlay{position:absolute;inset:0;background:linear-gradient(180deg, rgba(0,0,0,.26), rgba(0,0,0,.45));z-index:1}
    .hero-content{position:relative;z-index:2;height:100%;display:flex;flex-direction:column;align-items:center;justify-content:center;color:#fff;text-align:center;padding:24px}
    .hero h1{font-weight:300;margin-bottom:.3rem;font-size:clamp(1.6rem,4vw,3.4rem)}
    .hero p{margin-bottom:1rem;color:rgba(255,255,255,.95)}
    .hero .actions{display:flex;gap:10px;flex-wrap:wrap;justify-content:center}
    .btn{padding:12px 18px;border-radius:10px;border:0;display:inline-flex;gap:8px;align-items:center}
    .btn-primary{background:var(--accent);color:#fff}
    .btn-secondary{background:#fff;color:#333;box-shadow:var(--shadow)}
    .carousel-btn{position:absolute;top:50%;transform:translateY(-50%);background:rgba(255,255,255,0.16);width:48px;height:48px;border-radius:50%;display:grid;place-items:center;border:0;color:#fff;z-index:3}
    .carousel-btn.left{left:12px}
    .carousel-btn.right{right:12px}
    .hero-indicators{position:absolute;left:50%;transform:translateX(-50%);bottom:18px;display:flex;gap:8px;z-index:3}
    .hero-indicators button{width:10px;height:10px;border-radius:999px;border:0;background:rgba(255,255,255,0.5)}
    .hero-indicators button.active{background:#fff}

    /* ==========================================================================
       SECTIONS
       ========================================================================== */
    section {margin:28px 0}
    h2{font-weight:300;font-size:1.8rem;margin-bottom:8px;text-align:center}
    p.lead{color:var(--muted);margin-bottom:18px;text-align:center}

    /* Rooms */
    .rooms-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(260px,1fr));gap:18px;margin-top:18px}
    .room-card{background:var(--card);border-radius:10px;overflow:hidden;box-shadow:var(--shadow);display:flex;flex-direction:column}
    .room-header{padding:14px 16px;background:#fafafa;font-weight:600}
    .room-carousel{position:relative;height:220px;overflow:hidden;background:#f3f4f6}
    .room-carousel img{width:100%;height:100%;object-fit:cover;display:block;cursor:pointer}
    .room-info{padding:14px 16px;flex:1;display:flex;flex-direction:column}
    .room-info .meta{color:var(--muted);font-size:0.95rem;margin-bottom:8px}
    .divider{height:1px;background:#f0f0f0;margin:12px 0}

    /* Benefit cards (style from screenshot) */
    .benefits-grid{
      display:grid;
      grid-template-columns:repeat(auto-fit,minmax(220px,1fr));
      gap:18px;
      max-width:980px;margin:0 auto;
    }
    .benefit-card{
      background:var(--card);
      padding:20px;
      border-radius:12px;
      box-shadow:var(--shadow);
      text-align:center;
      transition:transform .18s ease, box-shadow .18s ease;
      display:flex;flex-direction:column;align-items:center;gap:8px;
    }
    .benefit-card:hover{transform:translateY(-6px)}
    .benefit-icon{
      width:64px;height:64px;border-radius:12px;background:#fff;display:grid;place-items:center;box-shadow:0 6px 18px rgba(16,24,40,0.06);
      font-size:26px;
    }
    .benefit-card h3{margin:0;font-size:1rem}
    .benefit-card p{margin:0;color:var(--muted);font-size:0.95rem}

    /* Testimonials */
    .testimonials-grid{display:grid;grid-template-columns:repeat(3,1fr);gap:18px;max-width:980px;margin:0 auto}
    .testimonial-card{
      background:var(--card);
      padding:18px;border-radius:12px;box-shadow:var(--shadow);
      min-height:140px;display:flex;flex-direction:column;justify-content:space-between;
    }
    .testimonial-text{font-style:italic;color:var(--muted)}
    .testimonial-author{display:flex;align-items:center;gap:12px;margin-top:10px}
    .author-avatar{width:44px;height:44px;border-radius:50%;background:var(--accent);color:#fff;display:flex;align-items:center;justify-content:center;font-weight:700}
    .testimonial-stars{color:#f6b93b}

    /* Reservation */
    .reservation-section{background:linear-gradient(135deg,#fa6866 0%,#fd8365 100%);padding:18px;border-radius:12px;color:#fff}
    .reservation-cards{display:grid;grid-template-columns:repeat(auto-fit,minmax(320px,1fr));gap:12px;margin-top:12px}
    .reservation-card{background:rgba(255,255,255,0.12);padding:18px;border-radius:12px}
    .form-group{margin-bottom:10px}
    .form-group label{display:block;margin-bottom:6px;font-weight:600}
    .form-group input,.form-group select{width:100%;padding:10px;border-radius:8px;border:2px solid rgba(255,255,255,0.18);background:transparent;color:#fff}
    .btn-select{width:100%;padding:10px;border-radius:8px;background:rgba(255,255,255,0.08);border:2px solid rgba(255,255,255,0.14);color:#fff}
    .transfer-btn{width:100%;padding:10px;border-radius:8px;background:transparent;border:2px solid rgba(255,255,255,0.18);color:#fff;margin-bottom:8px}
    .transfer-btn.active{background:linear-gradient(135deg,#3498db,#2d8fcb)}
    .price-summary{background:rgba(255,255,255,0.06);padding:10px;border-radius:8px;margin-top:10px}
    .price-line{display:flex;justify-content:space-between;margin-bottom:6px}
    .price-line.total{font-weight:700;font-size:1.05rem;padding-top:6px;border-top:1px solid rgba(255,255,255,0.08)}

    /* ==========================================================================
       OVERLAYS & MODALS
       ========================================================================== */
    .overlay{position:fixed;inset:0;background:rgba(0,0,0,0.6);display:none;align-items:center;justify-content:center;z-index:9999;padding:14px}
    .overlay.show{display:flex}
    .modal{background:#fff;border-radius:12px;max-width:920px;width:100%;max-height:calc(100vh - 40px);overflow:auto;position:relative}
    .modal.fullscreen{height:100vh;border-radius:0;padding:12px;max-height:100vh}
    .modal .modal-close{position:absolute;right:12px;top:12px;border:0;background:transparent;font-size:20px;cursor:pointer}

    /* Calendar visuals: NOTE: user requested green for "reservado" and red for "dispon√≠vel" */
    .calendar-header{display:flex;align-items:center;justify-content:space-between;padding:10px;border-bottom:1px solid #eee;position:sticky;top:0;background:#fff;z-index:2}
    .calendar-grid{display:grid;grid-template-columns:repeat(7,1fr);gap:8px;padding:12px}
    .calendar-day{display:flex;flex-direction:column;align-items:center;justify-content:center;padding:10px;border-radius:8px;border:1px solid #e9e9e9;background:#fff;color:#111}
    .calendar-day.empty{background:transparent;border:none}
    /* Inverted colors per request: reserved = green, available = red */
    .calendar-day.reserved{background:var(--accent);color:#fff;cursor:default}
    .calendar-day.available{background:var(--danger);color:#fff}
    .calendar-day.past{opacity:.45;cursor:not-allowed}
    .calendar-day.today{box-shadow:inset 0 0 0 2px rgba(0,0,0,0.06)}
    .calendar-day.selected{outline:3px solid rgba(255,255,255,0.25)}
    .day-number{font-weight:700}
    .day-price{font-size:12px;color:#fff;margin-top:6px}

    /* beds / suites */
    .beds-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(80px,1fr));gap:8px}
    .bed-item{padding:10px;border-radius:8px;border:1px solid #e9e9e9;background:#fff;display:flex;flex-direction:column;align-items:center;gap:8px}
    /* per request: reserved = green, available = red */
    .bed-item.reserved{background:var(--accent);color:#fff;border-color:var(--accent)}
    .bed-item:not(.reserved){background:var(--danger);color:#fff;border-color:var(--danger)} /* available shown red */
    .bed-item.selected{box-shadow:0 8px 20px rgba(0,0,0,0.12);transform:translateY(-4px)}
    .bed-item svg{width:34px;height:22px}
    .beds-legend{display:flex;gap:20px;justify-content:center;margin:16px 0}
    .legend-box{width:18px;height:18px;border-radius:4px;display:inline-block;margin-right:6px}
    .legend-box.reserved{background:var(--accent)}
    .legend-box.available{background:var(--danger)}

    .suite-item{padding:12px;border-radius:10px;border:1px solid #eaeaea;background:#fff;text-align:center}
    .suite-item.selected{background:var(--accent);color:#fff;border-color:var(--accent)}
    .suite-item.reserved{background:var(--accent);color:#fff;border-color:var(--accent)}
    .suite-item.available{background:var(--danger);color:#fff;border-color:var(--danger)}

    .lightbox{position:fixed;inset:0;background:rgba(0,0,0,0.95);display:none;align-items:center;justify-content:center;z-index:99999}
    .lightbox.show{display:flex}
    .lightbox img{max-width:94%;max-height:94%}

    footer{padding:24px;text-align:center;background:#111;color:#fff;border-top:1px solid rgba(255,255,255,0.03);margin-top:24px;border-bottom-left-radius:8px;border-bottom-right-radius:8px}

    /* icons sizing */
    .icon{width:20px;height:20px;display:inline-block;vertical-align:middle}
    .icon-lg{width:28px;height:28px}

    /* RESPONSIVE */
    @media (max-width:900px){
      .hero{height:60vh}
      .room-carousel{height:180px}
      .calendar-grid{gap:6px}
      .testimonials-grid{grid-template-columns:repeat(2,1fr)}
    }
    @media (max-width:640px){
      .testimonials-grid{grid-template-columns:1fr}
      .rooms-grid{grid-template-columns:1fr}
      .benefits-grid{grid-template-columns:repeat(auto-fit,minmax(160px,1fr))}
    }
  </style>
</head>
<body>
  <div id="app">
    <header>
      <div class="container topbar">
        <div class="brand">FreiSa Hostel</div>
        <div class="spacer"></div>
        <!-- sheet input removed as requested -->
      </div>
    </header>

    <main class="container">
      <!-- HERO -->
      <section class="hero" id="hero">
        <div class="hero-slide" style="background-image:url('https://i.imgur.com/JXIOXmJ.jpeg')"></div>
        <div class="hero-slide" style="background-image:url('https://i.imgur.com/sjw1dGZ.jpeg')"></div>
        <div class="hero-slide" style="background-image:url('https://i.imgur.com/ftDKRIH.jpeg')"></div>
        <div class="hero-slide" style="background-image:url('https://i.imgur.com/YDrxJUS.jpeg')"></div>

        <div class="hero-overlay"></div>
        <div class="hero-content">
          <h1>FreiSa Hostel</h1>
          <p>Hospitalidade que conecta pessoas em Copacabana.</p>
          <div class="actions">
            <button class="btn btn-primary" id="toReservationBtn">Reservar</button>
            <button class="btn btn-secondary" id="toRoomsBtn">Conhecer quartos</button>
          </div>
        </div>

        <button class="carousel-btn left" id="heroPrev" aria-label="Anterior">‚Äπ</button>
        <button class="carousel-btn right" id="heroNext" aria-label="Pr√≥ximo">‚Ä∫</button>
        <div class="hero-indicators" id="heroIndicators"></div>
      </section>

      <!-- ROOMS -->
      <section aria-labelledby="roomsTitle" id="roomsSection">
        <h2 id="roomsTitle">Nossos quartos</h2>
        <p class="lead">Escolha o espa√ßo que combina com sua viagem ‚Äî dormit√≥rios, su√≠tes e espa√ßos privativos.</p>
        <div class="rooms-grid" id="roomsGrid"></div>
      </section>

      <!-- BENEFITS -->
      <section>
        <h2>Por que escolher o FreiSa Hostel?</h2>
        <p class="lead">Localiza√ß√£o, conforto e ambiente acolhedor para viajantes do mundo todo.</p>
        <div class="benefits-grid" id="benefitsGrid">
          <!-- inserted via JS or static fallback -->
        </div>
      </section>

      <!-- TESTIMONIALS -->
      <section>
        <h2>O que dizem nossos h√≥spedes</h2>
        <div class="testimonials-grid" id="testimonialsGrid"></div>
      </section>

      <!-- RESERVATION -->
      <section class="reservation-section" id="reservationSection">
        <h2 id="reservationTitle" style="color:#fff">Reservas</h2>
        <p class="lead" style="color:rgba(255,255,255,0.95)">Verifique disponibilidade e monte sua reserva.</p>
        <div class="reservation-cards" id="reservationCards"></div>
      </section>
    </main>

    <footer>
      <div style="font-weight:700">FreiSa Hostel</div>
      <div>Copacabana, Rio de Janeiro ‚Äî Brasil</div>
      <div>WhatsApp: +55 21 99730-5179</div>
      <div style="opacity:.8;margin-top:8px">¬© 2025 FreiSa Hostel ‚Äî Todos os direitos reservados</div>
    </footer>

    <!-- Overlays / Modals -->
    <div class="overlay" id="calendarOverlay" aria-hidden="true"></div>
    <div class="overlay" id="bedsOverlay" aria-hidden="true"></div>
    <div class="overlay" id="suitesOverlay" aria-hidden="true"></div>
    <div class="overlay" id="detailOverlay" aria-hidden="true"></div>
    <div class="lightbox" id="lightbox" aria-hidden="true"></div>
  </div>

  <script>
  /**************************************************************************
   * v3 - Updated:
   * - Calendar coloring inverted to show: green => "reservado", red => "dispon√≠vel"
   * - Beds & Suites visuals show icons and follow same color scheme
   * - Benefit and testimonial cards styled to match screenshots
   * - Keep Google Sheets integration; paste ID in DEFAULT_SHEET_ID variable below
   **************************************************************************/

  /* ================= CONFIG ================= */
  const DEFAULT_SHEET_ID = '1QZewic2mbwaksGyIx5MN7mWTukQdxBOb2yheCydFdCM'; // replace with your sheet ID or leave empty for fallback
  const SHEET_ID = localStorage.getItem('freisa_sheet_id') || DEFAULT_SHEET_ID;
  const SHEET_GIDS = {
    calendar: '0',
    pricing: '53054799',
    rooms: '109166723',
    beds: '844940838',
    suites: '1830778583',
    extras: '1216063608'
  };
  const SHEET_URL = id => `https://docs.google.com/spreadsheets/d/${id}/export?format=csv&gid=`;
  const CACHE_KEY = 'freisa_sheets_cache_v3';
  const CACHE_DURATION = 10 * 60 * 1000;

  /* ================= Utilities ================= */
  const qs = s => document.querySelector(s);
  const qsa = s => Array.from(document.querySelectorAll(s));

  function parseCSV(csvText){
    if(!csvText) return [];
    const rows = [];
    let cur = '', row = [], inQ = false;
    for (let i=0;i<csvText.length;i++){
      const ch = csvText[i], nx = csvText[i+1];
      if (ch === '"') { if (inQ && nx === '"'){ cur += '"'; i++; continue; } inQ = !inQ; continue; }
      if (ch === ',' && !inQ){ row.push(cur); cur=''; continue; }
      if ((ch === '\n' || ch === '\r') && !inQ){ if (cur !== '' || row.length){ row.push(cur); rows.push(row); row=[]; cur=''; } continue; }
      cur += ch;
    }
    if (cur !== '' || row.length){ row.push(cur); rows.push(row); }
    if (!rows.length) return [];
    const headers = rows[0].map(h => h.trim());
    return rows.slice(1).map(r => {
      const o={};
      headers.forEach((h,i)=> o[h]= (r[i]||'').trim());
      return o;
    });
  }

  function getCached(){
    try {
      const raw = localStorage.getItem(CACHE_KEY);
      if(!raw) return null;
      const p = JSON.parse(raw);
      if(!p.timestamp) return null;
      if(Date.now() - p.timestamp > CACHE_DURATION){ localStorage.removeItem(CACHE_KEY); return null; }
      return p.data;
    } catch { return null; }
  }
  function setCached(data){ try { localStorage.setItem(CACHE_KEY, JSON.stringify({ data, timestamp: Date.now() })); } catch(e){ console.warn(e); } }

  async function fetchSheet(gid, retry=0){
    const id = SHEET_ID;
    if (!id) throw new Error('SHEET_ID n√£o configurado');
    const url = SHEET_URL(id) + gid;
    try {
      const res = await fetch(url);
      if (!res.ok) throw new Error('HTTP ' + res.status);
      const txt = await res.text();
      return parseCSV(txt);
    } catch(err) {
      if (retry < 1) { await new Promise(r=>setTimeout(r,800)); return fetchSheet(gid, retry+1); }
      throw err;
    }
  }

  /* ================= Data store & price / availability logic (same as before) ================= */
  let SHEETS = { calendar:[], pricing:[], rooms:[], beds:[], suites:[], extras:[] };
  function fallbackSheets(){
    return {
      calendar: [], pricing: [], rooms: [
        { room_id: 'jb', name: 'Nice Place', type: 'dorm', max_guests: '14' },
        { room_id: 'ar', name: 'Quarto Feminino FreiSa', type: 'dorm', max_guests: '14' },
        { room_id: 'q007', name: 'Quarto Misto', type: 'dorm', max_guests: '14' },
        { room_id: 'q777', name: 'Su√≠tes', type: 'suite', max_guests: '3' }
      ], beds: [], suites: [],
      extras: [
        { key: 'early_checkin', price: '30' },
        { key: 'late_checkout', price: '30' },
        { key: 'transfer_arrival', price: '150' },
        { key: 'transfer_departure', price: '150' },
        { key: 'base_price_nice_place', price: '100' },
        { key: 'base_price_quarto_feminino', price: '120' },
        { key: 'base_price_quarto_misto', price: '100' },
        { key: 'base_price_suites', price: '300' }
      ]
    };
  }

  async function loadSheets(){
    const cached = getCached();
    if (cached){ SHEETS = cached; renderAll(); refreshSheets(); return; }
    if (!SHEET_ID){ SHEETS = fallbackSheets(); renderAll(); return; }
    try {
      const [calendar, pricing, rooms, beds, suites, extras] = await Promise.all([
        fetchSheet(SHEET_GIDS.calendar),
        fetchSheet(SHEET_GIDS.pricing),
        fetchSheet(SHEET_GIDS.rooms),
        fetchSheet(SHEET_GIDS.beds),
        fetchSheet(SHEET_GIDS.suites),
        fetchSheet(SHEET_GIDS.extras)
      ]);
      SHEETS = { calendar, pricing, rooms, beds, suites, extras };
      setCached(SHEETS);
      renderAll();
    } catch(err){
      console.warn('Erro ao carregar sheets:', err);
      SHEETS = fallbackSheets();
      renderAll();
    }
  }
  async function refreshSheets(){ if (!SHEET_ID) return; try { const [calendar, pricing, rooms, beds, suites, extras] = await Promise.all([ fetchSheet(SHEET_GIDS.calendar), fetchSheet(SHEET_GIDS.pricing), fetchSheet(SHEET_GIDS.rooms), fetchSheet(SHEET_GIDS.beds), fetchSheet(SHEET_GIDS.suites), fetchSheet(SHEET_GIDS.extras) ]); SHEETS = { calendar, pricing, rooms, beds, suites, extras }; setCached(SHEETS); renderAll(); } catch(e){ } }

  function formatLocalDateJS(d){ return `${d.getFullYear()}-${String(d.getMonth()+1).padStart(2,'0')}-${String(d.getDate()).padStart(2,'0')}`; }
  function parseLocalDate(str){ if(!str) return null; const [y,m,d] = str.split('-').map(Number); return new Date(y,m-1,d); }
  function formatBR(dStr){ if(!dStr) return ''; const d = parseLocalDate(dStr); return `${String(d.getDate()).padStart(2,'0')}/${String(d.getMonth()+1).padStart(2,'0')}/${d.getFullYear()}`; }
  function formatCurrency(v){ const n = Number(v || 0); return 'R$ ' + n.toFixed(2).replace('.', ','); }

  function getBasePrice(roomId){
    const priceKeys = { jb: 'base_price_nice_place', ar: 'base_price_quarto_feminino', q007: 'base_price_quarto_misto', q777: 'base_price_suites' };
    const key = priceKeys[roomId];
    if (!key) return 100;
    const extra = SHEETS.extras.find(e => e.key === key);
    return extra ? parseFloat(extra.price) : 100;
  }

  function checkAvailability(roomId, checkin, checkout){
    if (!checkin || !checkout || !SHEETS.calendar.length) return { availableBeds: [], availableSuites: [], isAvailable: true };
    const start = parseLocalDate(checkin), end = parseLocalDate(checkout);
    const dates = [];
    for (let d = new Date(start); d < end; d.setDate(d.getDate()+1)) dates.push(formatLocalDateJS(new Date(d)));
    const blocked = SHEETS.calendar.filter(r => r.room_id === roomId && dates.includes(r.date) && (r.status === 'reserved' || r.status === 'blocked'));
    if (blocked.length) return { availableBeds: [], availableSuites: [], isAvailable: false };
    const availableBeds = [];
    if (roomId !== 'q777'){ for (let i=1;i<=7;i++) ['T','B'].forEach(pos => { const bedId = `C${i}-${pos}`; const isBooked = dates.some(date => SHEETS.beds.some(b => b.room_id === roomId && b.date === date && b.bed_id === bedId && b.status === 'booked')); if (!isBooked) availableBeds.push(bedId); }); }
    const availableSuites = [];
    if (roomId === 'q777'){ ['S1','S2','S3'].forEach(sid => { const isBooked = dates.some(date => SHEETS.suites.some(s => s.date === date && s.suite_id === sid && s.status === 'booked')); if (!isBooked) availableSuites.push(sid); }); }
    return { availableBeds, availableSuites, isAvailable: true };
  }

  function computeDynamicPricing(roomId, checkin, checkout, guests=1, selectedBeds=[], selectedSuites=[]){
    if (!checkin || !checkout) return { nightlyPrices: [], baseTotal: 0 };
    const start = parseLocalDate(checkin), end = parseLocalDate(checkout);
    const nights = Math.ceil((end - start) / (1000*60*60*24));
    const nightlyPrices = []; let baseTotal = 0;
    for (let i=0;i<nights;i++){
      const d = new Date(start); d.setDate(d.getDate()+i); const dateStr = formatLocalDateJS(d);
      const priceRow = SHEETS.pricing.find(p => p.room_id === roomId && p.date === dateStr);
      const pricePerUnit = priceRow ? parseFloat(priceRow.price) : getBasePrice(roomId);
      let nightTotal = roomId === 'q777' ? pricePerUnit * selectedSuites.length : pricePerUnit * guests;
      nightlyPrices.push({ date: dateStr, price: pricePerUnit, total: nightTotal });
      baseTotal += nightTotal;
    }
    return { nightlyPrices, baseTotal };
  }

  function getExtraPrice(key){ const r = SHEETS.extras.find(e => e.key === key); return r ? parseFloat(r.price) : 0; }

  /* ================= Static rooms / sample content for UI ================= */
  const staticRooms = [
    { name: 'Quarto Feminino FreiSa', roomId: 'ar', location:'Copacabana, RJ', beds:14, bathrooms:'4 banheiros compartilhados', images:['https://i.imgur.com/5RmzKKS.jpeg','https://i.imgur.com/32uJWkj.jpeg','https://i.imgur.com/Pyt9BLd.jpeg','https://i.imgur.com/QoRrocG.jpeg'], description:'Quarto exclusivo feminino acolhedor.' },
    { name: 'Quarto Misto', roomId: 'q007', location:'Copacabana, RJ', beds:14, bathrooms:'Banheiros compartilhados', images:['https://i.imgur.com/OddkKoI.jpeg'], description:'Quarto misto, confort√°vel.' },
    { name: 'Su√≠tes', roomId: 'q777', location:'Copacabana, RJ', beds:3, bathrooms:'Banheiro privativo', images:['https://i.imgur.com/W9koWkI.jpeg'], description:'Su√≠tes privativas.' },
    { name: 'Nice Place', roomId: 'jb', location:'Copacabana, RJ', beds:14, bathrooms:'2 banheiros compartilhados', images:['https://i.imgur.com/OddkKoI.jpeg','https://i.imgur.com/W9koWkI.jpeg','https://i.imgur.com/yEaKK3Q.jpeg','https://i.imgur.com/HUd2mEN.jpeg'], description:'Espa√ßo confort√°vel e bem localizado.' }
  ];

  /* ================= Render benefits & testimonials (matching screenshots) ================= */
  function renderBenefits(){
    const benefits = [
      { icon:'üìç', title:'Localiza√ß√£o Estrat√©gica', text:'Em Copacabana, perto de tudo que voc√™ precisa' },
      { icon:'üí∞', title:'Excelente Custo-Benef√≠cio', text:'Pre√ßos justos para uma experi√™ncia incr√≠vel' },
      { icon:'üîí', title:'Conforto e Seguran√ßa', text:'Sua estadia tranquila √© nossa prioridade' },
      { icon:'ü§ù', title:'Ambiente Social', text:'Conhe√ßa viajantes do mundo todo' },
      { icon:'üç≥', title:'Estrutura Pr√°tica', text:'Cozinha compartilhada e √°reas comuns' },
      { icon:'üå≥', title:'Experi√™ncia Carioca', text:'Viva o Rio de Janeiro autenticamente' }
    ];
    const container = qs('#benefitsGrid');
    container.innerHTML = benefits.map(b => `
      <div class="benefit-card">
        <div class="benefit-icon">${b.icon}</div>
        <h3>${b.title}</h3>
        <p>${b.text}</p>
      </div>
    `).join('');
  }

  function renderTestimonials(){
    const testimonials = [
      { text:'Fiquei 4 noites em Copacabana. Localiza√ß√£o excelente ‚Äî mercados, padarias e bares na mesma rua; a apenas 2 minutos da praia...', name:'H√≥spede', location:'Brasil' },
      { text:'Minha hospedagem foi super tranquila. A um quarteir√£o da praia e perto do SESC Copacabana...', name:'H√≥spede', location:'Internacional' },
      { text:'Localiza√ß√£o excelente; o propriet√°rio estava dispon√≠vel sempre que precisei...', name:'H√≥spede', location:'S√£o Paulo' }
    ];
    const container = qs('#testimonialsGrid');
    container.innerHTML = testimonials.map(t => `
      <div class="testimonial-card">
        <div class="testimonial-text">"${t.text}"</div>
        <div class="testimonial-author">
          <div class="author-avatar">${t.name[0]}</div>
          <div>
            <div style="font-weight:700">${t.name}</div>
            <div style="color:var(--muted)">${t.location}</div>
          </div>
        </div>
        <div class="testimonial-stars">‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ</div>
      </div>
    `).join('');
  }

  /* ================= Render rooms grid and carousels (preserve images & lightbox) ================= */
  function renderRoomsGrid(){
    const container = qs('#roomsGrid');
    container.innerHTML = staticRooms.map((r, idx) => {
      const indicators = r.images.length > 1 ? `<div class="hero-indicators" data-room="${idx}">${r.images.map((_,i)=>`<button data-i="${i}" class="${i===0?'active':''}"></button>`).join('')}</div>` : '';
      const nav = r.images.length > 1 ? `<button class="carousel-btn left" data-idx="${idx}" data-action="prev">‚Äπ</button><button class="carousel-btn right" data-idx="${idx}" data-action="next">‚Ä∫</button>` : '';
      return `
        <article class="room-card" data-roomid="${r.roomId}">
          <div class="room-header">${r.name}</div>
          <div class="room-carousel" id="roomCarousel${idx}">
            <img src="${r.images[0]}" alt="${r.name}" data-idx="0" data-room="${idx}" />
            ${nav}
            ${indicators}
          </div>
          <div class="room-info">
            <div class="meta">${r.location} ¬∑ ${r.beds} camas ¬∑ ${r.bathrooms}</div>
            <div class="divider"></div>
            <div style="color:var(--muted)">${r.description}</div>
            <div style="margin-top:auto"><button class="btn" data-detail="${idx}" style="margin-top:10px">Mostrar mais</button></div>
          </div>
        </article>
      `;
    }).join('');

    staticRooms.forEach((r, idx) => {
      const carousel = qs(`#roomCarousel${idx}`);
      if(!carousel) return;
      const img = carousel.querySelector('img');
      let cur = 0;
      function show(i){
        cur = ((i % r.images.length) + r.images.length) % r.images.length;
        img.src = r.images[cur];
        carousel.querySelectorAll('.hero-indicators button').forEach((b,bi)=> b.classList.toggle('active', bi===cur));
      }
      const nextBtn = carousel.querySelector('[data-action="next"]');
      const prevBtn = carousel.querySelector('[data-action="prev"]');
      if(nextBtn) nextBtn.addEventListener('click', ()=> show(cur+1));
      if(prevBtn) prevBtn.addEventListener('click', ()=> show(cur-1));
      carousel.querySelectorAll('.hero-indicators button').forEach((b,i)=> b.addEventListener('click', ()=> show(i)));
      img.addEventListener('click', ()=> openLightbox(r.images, cur));
    });

    qsa('[data-detail]').forEach(btn => btn.addEventListener('click', e => {
      const idx = Number(e.currentTarget.getAttribute('data-detail'));
      openDetailModal(staticRooms[idx]);
    }));
  }

  /* ================= Lightbox ================= */
  function openLightbox(images, index=0){
    const lb = qs('#lightbox');
    lb.innerHTML = `<div style="position:relative;max-width:95%;max-height:95%"><button style="position:absolute;right:-10px;top:-10px;background:#fff;border-radius:999px;width:40px;height:40px;border:0;font-size:20px" id="lbClose">√ó</button><img id="lbImg" src="${images[index]}" alt="" /></div>`;
    lb.classList.add('show'); lb.setAttribute('aria-hidden','false');
    let cur = index;
    function show(i){ cur = ((i % images.length)+images.length)%images.length; qs('#lbImg').src = images[cur]; }
    function onKey(e){ if(e.key==='Escape') close(); if(e.key==='ArrowRight') show(cur+1); if(e.key==='ArrowLeft') show(cur-1); }
    function close(){ lb.classList.remove('show'); lb.innerHTML=''; lb.setAttribute('aria-hidden','true'); document.removeEventListener('keydown', onKey); }
    qs('#lbClose').addEventListener('click', close);
    lb.addEventListener('click', ev => { if (ev.target === lb) close(); });
    document.addEventListener('keydown', onKey);
  }

  /* ================= Detail modal ================= */
  function openDetailModal(room){
    const overlay = qs('#detailOverlay');
    overlay.innerHTML = `<div class="modal"><button class="modal-close" id="detailClose">√ó</button><div style="padding:16px"><h3>${room.name}</h3><p style="color:var(--muted)">${room.location} ¬∑ ${room.beds} camas</p><div style="margin-top:12px">${room.description}<br/><br/>Detalhes completos podem ser colocados aqui.</div></div></div>`;
    overlay.classList.add('show'); overlay.setAttribute('aria-hidden','false');
    qs('#detailClose').addEventListener('click', ()=> overlay.classList.remove('show'));
    overlay.addEventListener('click', ev => { if (ev.target === overlay) overlay.classList.remove('show'); });
  }

  /* ================= Calendar modal (green=reserved, red=available) ================= */
  let calendarState = { roomId:null, onSelect:null, currentDate:new Date() };
  function openCalendar({ roomId, onSelect, initial = null }){
    calendarState.roomId = roomId;
    calendarState.onSelect = onSelect;
    calendarState.currentDate = initial ? parseLocalDate(initial) : new Date();

    const overlay = qs('#calendarOverlay');
    const isMobile = window.innerWidth <= 768;
    overlay.innerHTML = '';
    overlay.classList.add('show'); overlay.setAttribute('aria-hidden','false');

    const modal = document.createElement('div');
    modal.className = 'modal ' + (isMobile ? 'fullscreen' : '');
    modal.innerHTML = `
      <div class="calendar-header">
        <div style="display:flex;gap:8px;align-items:center">
          <button id="calPrev" class="btn">‚Äπ</button>
          <strong id="calMonth"></strong>
        </div>
        <div style="display:flex;gap:8px;align-items:center">
          <button id="calNext" class="btn">‚Ä∫</button>
          <button class="modal-close" id="calClose">√ó</button>
        </div>
      </div>
      <div style="padding:12px">
        <div style="display:grid;grid-template-columns:repeat(7,1fr);gap:6px;color:var(--muted);font-weight:700;margin-bottom:8px">
          <div>Dom</div><div>Seg</div><div>Ter</div><div>Qua</div><div>Qui</div><div>Sex</div><div>S√°b</div>
        </div>
        <div class="calendar-grid" id="calendarGrid"></div>
        <div style="display:flex;gap:12px;justify-content:center;margin-top:12px">
          <div style="display:flex;align-items:center;gap:8px"><span class="legend-box reserved"></span><span>Reservado</span></div>
          <div style="display:flex;align-items:center;gap:8px"><span class="legend-box available"></span><span>Dispon√≠vel</span></div>
        </div>
      </div>
    `;
    overlay.appendChild(modal);

    modal.querySelector('#calPrev').addEventListener('click', ()=> { calendarState.currentDate = new Date(calendarState.currentDate.getFullYear(), calendarState.currentDate.getMonth()-1, 1); renderCalendar(); });
    modal.querySelector('#calNext').addEventListener('click', ()=> { calendarState.currentDate = new Date(calendarState.currentDate.getFullYear(), calendarState.currentDate.getMonth()+1, 1); renderCalendar(); });
    modal.querySelector('#calClose').addEventListener('click', closeCalendar);
    overlay.addEventListener('click', ev => { if (ev.target === overlay) closeCalendar(); });

    renderCalendar();
  }
  function closeCalendar(){ const o = qs('#calendarOverlay'); o.classList.remove('show'); o.innerHTML=''; }
  function renderCalendar(){
    const modal = qs('#calendarOverlay .modal'); if(!modal) return;
    const monthNames = ['Janeiro','Fevereiro','Mar√ßo','Abril','Maio','Junho','Julho','Agosto','Setembro','Outubro','Novembro','Dezembro'];
    const month = calendarState.currentDate.getMonth(), year = calendarState.currentDate.getFullYear();
    qs('#calMonth').textContent = `${monthNames[month]} ${year}`;
    const firstDay = new Date(year, month, 1).getDay();
    const daysInMonth = new Date(year, month+1, 0).getDate();
    const grid = qs('#calendarGrid');
    grid.innerHTML = '';

    for (let i=0;i<firstDay;i++){ const el = document.createElement('div'); el.className='calendar-day empty'; grid.appendChild(el); }

    const today = new Date(); today.setHours(0,0,0,0);
    for (let d=1; d<=daysInMonth; d++){
      const date = new Date(year, month, d); date.setHours(0,0,0,0);
      const dateStr = formatLocalDateJS(date);
      const isPast = date < today;
      const priceRow = SHEETS.pricing.find(p => p.room_id === calendarState.roomId && p.date === dateStr);
      const price = priceRow ? parseFloat(priceRow.price) : getBasePrice(calendarState.roomId);
      const reserved = SHEETS.calendar.some(r => r.room_id === calendarState.roomId && r.date === dateStr && (r.status === 'reserved' || r.status === 'blocked'));
      const btn = document.createElement('button');
      // Use class "reserved" when reserved (green); otherwise "available" (red) ‚Äî per user's request
      btn.className = 'calendar-day ' + (reserved ? 'reserved' : (isPast ? 'past' : 'available'));
      btn.disabled = reserved || isPast;
      btn.innerHTML = `<div class="day-number">${d}</div><div class="day-price">${formatCurrency(price)}</div>`;
      if (!reserved && !isPast) btn.addEventListener('click', ()=> { if (typeof calendarState.onSelect === 'function') calendarState.onSelect(dateStr); closeCalendar(); });
      grid.appendChild(btn);
    }
  }

  /* ================= Beds modal (icons included) ================= */
  // bedSvg: simple bed icon (inline) and suiteSvg for suites
  const bedSvg = `<svg viewBox="0 0 24 24" width="34" height="24" fill="none" xmlns="http://www.w3.org/2000/svg">
    <rect x="2" y="8" width="20" height="8" rx="1.5" stroke="#111" stroke-width="1.2" fill="none"/>
    <path d="M4 16v2" stroke="#111" stroke-width="1.2" stroke-linecap="round"/>
    <path d="M20 16v2" stroke="#111" stroke-width="1.2" stroke-linecap="round"/>
    <rect x="4" y="9" width="6" height="3" rx="1" fill="#111" opacity="0.08"/>
  </svg>`;
  const suiteSvg = `<svg viewBox="0 0 24 24" width="48" height="36" fill="none" xmlns="http://www.w3.org/2000/svg">
    <rect x="2" y="6" width="20" height="12" rx="2" stroke="#111" stroke-width="1.2" fill="none"/>
    <circle cx="7" cy="12" r="1.5" fill="#111" />
    <rect x="12" y="9" width="6" height="6" rx="1" fill="#111" opacity="0.06" />
  </svg>`;

  function openBedsModal({ roomId, maxBeds = 1, preselected = [], checkin, checkout, onConfirm }){
    const s = parseLocalDate(checkin), e = parseLocalDate(checkout); const dates=[]; if (s && e) for (let d=new Date(s); d<e; d.setDate(d.getDate()+1)) dates.push(formatLocalDateJS(new Date(d)));
    const overlay = qs('#bedsOverlay'); overlay.innerHTML=''; overlay.classList.add('show'); overlay.setAttribute('aria-hidden','false');
    const modal = document.createElement('div'); modal.className = 'modal';
    modal.innerHTML = `<button class="modal-close" id="bedsClose">√ó</button><div style="padding:14px"><h3>Mapa de camas ‚Äî selecione sua(s) cama(s)</h3><p style="color:var(--muted)">7 beliches ‚Äî 14 camas (superior e inferior)</p><div style="display:grid;gap:12px;margin-top:12px"><div><strong>Superior (Top)</strong><div class="beds-grid" id="bedsTop"></div></div><div><strong>Inferior (Bottom)</strong><div class="beds-grid" id="bedsBottom"></div></div></div><div class="beds-legend" style="margin-top:12px"><span><span class="legend-box reserved"></span>Reservada</span><span><span class="legend-box available"></span>Dispon√≠vel</span></div><div style="display:flex;gap:8px;justify-content:flex-end;margin-top:12px"><button id="bedsClear" class="btn">Limpar</button><button id="bedsConfirm" class="btn btn-primary">Confirmar sele√ß√£o</button></div></div>`;
    overlay.appendChild(modal);
    modal.querySelector('#bedsClose').addEventListener('click', ()=> overlay.classList.remove('show'));
    overlay.addEventListener('click', ev => { if (ev.target === overlay) overlay.classList.remove('show'); });

    const available = new Set();
    for (let i=1;i<=7;i++) ['T','B'].forEach(pos => {
      const bedId = `C${i}-${pos}`;
      const booked = dates.some(date => SHEETS.beds.some(b => b.room_id === roomId && b.date === date && b.bed_id === bedId && b.status === 'booked'));
      if (!booked) available.add(bedId);
    });

    let selected = new Set(preselected || []);
    const top = modal.querySelector('#bedsTop'), bottom = modal.querySelector('#bedsBottom');

    function makeButton(id){
      const btn = document.createElement('button');
      // if not available -> class reserved (we show reserved as green). If available -> no reserved class (we style not reserved as red)
      btn.className = 'bed-item' + (selected.has(id) ? ' selected' : '') + (available.has(id) ? '' : ' reserved');
      btn.innerHTML = `${bedSvg}<div style="font-weight:700">${id}</div>`;
      btn.disabled = !available.has(id) && !selected.has(id);
      btn.addEventListener('click', ()=>{
        if (!available.has(id)) return;
        if (selected.has(id)){ selected.delete(id); btn.classList.remove('selected'); }
        else { if (selected.size >= maxBeds) return alert('M√°ximo de camas selecionadas.'); selected.add(id); btn.classList.add('selected'); }
      });
      return btn;
    }

    for (let i=1;i<=7;i++) top.appendChild(makeButton(`C${i}-T`));
    for (let i=1;i<=7;i++) bottom.appendChild(makeButton(`C${i}-B`));

    modal.querySelector('#bedsClear').addEventListener('click', ()=> { selected.clear(); modal.querySelectorAll('.bed-item.selected').forEach(el=>el.classList.remove('selected')); });
    modal.querySelector('#bedsConfirm').addEventListener('click', ()=> { onConfirm(Array.from(selected)); overlay.classList.remove('show'); });
  }

  /* ================= Suites modal (icons included) ================= */
  function openSuitesModal({ checkin, checkout, preselected = [], onConfirm }){
    const { availableSuites } = checkAvailability('q777', checkin, checkout);
    const overlay = qs('#suitesOverlay'); overlay.innerHTML=''; overlay.classList.add('show'); overlay.setAttribute('aria-hidden','false');
    const modal = document.createElement('div'); modal.className='modal';
    modal.innerHTML = `<button class="modal-close" id="suitesClose">√ó</button><div style="padding:14px"><h3>Selecione sua(s) su√≠te(s)</h3><div style="display:grid;grid-template-columns:repeat(3,1fr);gap:12px;margin-top:12px" id="suitesGrid"></div><div style="display:flex;gap:8px;justify-content:flex-end;margin-top:12px"><button id="suitesClear" class="btn">Limpar</button><button id="suitesConfirm" class="btn btn-primary">Confirmar sele√ß√£o</button></div></div>`;
    overlay.appendChild(modal);
    modal.querySelector('#suitesClose').addEventListener('click', ()=> overlay.classList.remove('show'));
    overlay.addEventListener('click', ev => { if (ev.target === overlay) overlay.classList.remove('show'); });

    const grid = modal.querySelector('#suitesGrid'); let selected = new Set(preselected || []);
    ['S1','S2','S3'].forEach(sid => {
      const available = availableSuites.includes(sid);
      const div = document.createElement('div');
      div.className = 'suite-item' + (selected.has(sid) ? ' selected' : '') + (available ? ' available' : ' reserved');
      div.innerHTML = `<div style="margin-bottom:8px">${suiteSvg}</div><div style="font-weight:800">${sid}</div><div style="color:var(--muted);font-size:.95rem">R$ 300,00/di√°ria</div>`;
      div.addEventListener('click', ()=> {
        if (!available) return;
        if (selected.has(sid)){ selected.delete(sid); div.classList.remove('selected'); }
        else { if (selected.size >= 3) return alert('M√°ximo 3 su√≠tes'); selected.add(sid); div.classList.add('selected'); }
      });
      grid.appendChild(div);
    });

    modal.querySelector('#suitesClear').addEventListener('click', ()=> { selected.clear(); modal.querySelectorAll('.suite-item.selected').forEach(el=>el.classList.remove('selected')); });
    modal.querySelector('#suitesConfirm').addEventListener('click', ()=> { onConfirm(Array.from(selected)); overlay.classList.remove('show'); });
  }

  /* ================= Reservation cards rendering & interactions ================= */
  function renderReservationCards(){
    const container = qs('#reservationCards');
    container.innerHTML = staticRooms.map(r => `
      <div class="reservation-card" data-roomid="${r.roomId}">
        <h3 style="margin-top:0">${r.name}</h3>
        <div class="form-group"><label>Check-in</label><input type="text" data-role="checkin" placeholder="Selecione a data" readonly /></div>
        <div class="form-group"><label>Check-out</label><input type="text" data-role="checkout" placeholder="Selecione a data" readonly /></div>
        <div class="form-group"><label>H√≥spedes</label><select data-role="guests">${Array.from({length:14},(_,i)=>`<option value="${i+1}">${i+1}</option>`).join('')}</select></div>
        <button class="btn-select" data-role="selectbeds">${r.roomId==='q777' ? 'Selecionar su√≠tes' : 'Selecionar camas'}</button>
        <div class="extras">
          <label style="display:block"><input type="checkbox" data-role="early" /> Check-in antecipado (+${formatCurrency(getExtraPrice('early_checkin')||30)})</label>
          <label style="display:block"><input type="checkbox" data-role="late" /> Check-out estendido (+${formatCurrency(getExtraPrice('late_checkout')||30)})</label>
        </div>
        <div style="margin-top:8px">
          <button class="transfer-btn" data-role="transfer-in">Transfer ida (${formatCurrency(getExtraPrice('transfer_arrival')||150)})</button>
          <button class="transfer-btn" data-role="transfer-out">Transfer volta (${formatCurrency(getExtraPrice('transfer_departure')||150)})</button>
        </div>
        <div class="price-summary">
          <div class="price-line"><span>Hospedagem</span><span data-role="base">R$ 0,00</span></div>
          <div class="price-line"><span>Extras</span><span data-role="extras">R$ 0,00</span></div>
          <div class="price-line total"><span>Total</span><span data-role="total">R$ 0,00</span></div>
        </div>
        <div style="margin-top:10px;display:flex;gap:8px">
          <button class="btn btn-primary" data-role="reserve">Conferir disponibilidade</button>
        </div>
      </div>
    `).join('');

    qsa('.reservation-card').forEach(card => {
      const roomId = card.dataset.roomid;
      const checkinInput = card.querySelector('[data-role="checkin"]');
      const checkoutInput = card.querySelector('[data-role="checkout"]');
      const guestsSelect = card.querySelector('[data-role="guests"]');
      const selectBedsBtn = card.querySelector('[data-role="selectbeds"]');
      const earlyCb = card.querySelector('[data-role="early"]');
      const lateCb = card.querySelector('[data-role="late"]');
      const transferInBtn = card.querySelector('[data-role="transfer-in"]');
      const transferOutBtn = card.querySelector('[data-role="transfer-out"]');
      const baseEl = card.querySelector('[data-role="base"]');
      const extrasEl = card.querySelector('[data-role="extras"]');
      const totalEl = card.querySelector('[data-role="total"]');
      const reserveBtn = card.querySelector('[data-role="reserve"]');

      const state = { checkin:null, checkout:null, guests:1, selectedBeds:[], selectedSuites:[], early:false, late:false, transferIn:false, transferOut:false };

      function updatePriceUI(){
        const { baseTotal } = computeDynamicPricing(roomId, state.checkin, state.checkout, state.guests, state.selectedBeds, state.selectedSuites);
        let extras = 0;
        if (state.early) extras += getExtraPrice('early_checkin');
        if (state.late) extras += getExtraPrice('late_checkout');
        if (state.transferIn) extras += getExtraPrice('transfer_arrival');
        if (state.transferOut) extras += getExtraPrice('transfer_departure');
        baseEl.textContent = formatCurrency(baseTotal || 0);
        extrasEl.textContent = formatCurrency(extras || 0);
        totalEl.textContent = formatCurrency((baseTotal || 0) + extras);
      }

      function valid(){
        if (!state.checkin || !state.checkout) return false;
        if (parseLocalDate(state.checkout) <= parseLocalDate(state.checkin)) return false;
        if (roomId === 'q777') return state.selectedSuites.length > 0;
        return state.selectedBeds.length > 0 && state.selectedBeds.length <= state.guests;
      }

      checkinInput.addEventListener('click', ()=> openCalendar({ roomId, initial: state.checkin, onSelect: (dateStr)=> { state.checkin = dateStr; checkinInput.value = formatBR(dateStr); updatePriceUI(); } }));
      checkoutInput.addEventListener('click', ()=> openCalendar({ roomId, initial: state.checkout, onSelect: (dateStr)=> { state.checkout = dateStr; checkoutInput.value = formatBR(dateStr); updatePriceUI(); } }));
      guestsSelect.addEventListener('change', e => { state.guests = Number(e.target.value); updatePriceUI(); });

      selectBedsBtn.addEventListener('click', ()=> {
        if (roomId === 'q777'){
          openSuitesModal({ checkin: state.checkin, checkout: state.checkout, preselected: state.selectedSuites, onConfirm: (sel)=> { state.selectedSuites = sel; selectBedsBtn.textContent = `Selecionar su√≠tes (${sel.length})`; updatePriceUI(); } });
        } else {
          openBedsModal({ roomId, maxBeds: state.guests, preselected: state.selectedBeds, checkin: state.checkin, checkout: state.checkout, onConfirm: (sel)=> { state.selectedBeds = sel; selectBedsBtn.textContent = `Selecionar camas (${sel.length})`; updatePriceUI(); } });
        }
      });

      earlyCb.addEventListener('change', e => { state.early = e.target.checked; updatePriceUI(); });
      lateCb.addEventListener('change', e => { state.late = e.target.checked; updatePriceUI(); });

      transferInBtn.addEventListener('click', () => { state.transferIn = !state.transferIn; transferInBtn.classList.toggle('active', state.transferIn); updatePriceUI(); });
      transferOutBtn.addEventListener('click', () => { state.transferOut = !state.transferOut; transferOutBtn.classList.toggle('active', state.transferOut); updatePriceUI(); });

      reserveBtn.addEventListener('click', () => {
        if (!valid()) { alert('Por favor, complete todos os campos obrigat√≥rios corretamente.'); return; }
        const nights = Math.ceil((parseLocalDate(state.checkout) - parseLocalDate(state.checkin)) / (1000*60*60*24));
        const bedsText = roomId === 'q777' ? state.selectedSuites.join(', ') : state.selectedBeds.join(', ');
        const { baseTotal } = computeDynamicPricing(roomId, state.checkin, state.checkout, state.guests, state.selectedBeds, state.selectedSuites);
        let total = baseTotal;
        if (state.early) total += getExtraPrice('early_checkin');
        if (state.late) total += getExtraPrice('late_checkout');
        if (state.transferIn) total += getExtraPrice('transfer_arrival');
        if (state.transferOut) total += getExtraPrice('transfer_departure');

        let message = `Ol√°! Gostaria de solicitar reserva para ${r.name || roomId}.\n\nüìÖ Check-in: ${formatBR(state.checkin)}\nüìÖ Check-out: ${formatBR(state.checkout)}\nüåô Noites: ${nights}\nüë• H√≥spedes: ${state.guests}\n${roomId === 'q777' ? 'üè† Su√≠tes' : 'üõèÔ∏è Camas'} escolhidas: ${bedsText}\n\nüí∞ Resumo de valores:\n- Valor base: ${formatCurrency(baseTotal)}`;
        if (state.early) message += `\n- Check-in antecipado: ${formatCurrency(getExtraPrice('early_checkin'))}`;
        if (state.late) message += `\n- Check-out estendido: ${formatCurrency(getExtraPrice('late_checkout'))}`;
        if (state.transferIn) message += `\n- Transfer ida: ${formatCurrency(getExtraPrice('transfer_arrival'))}`;
        if (state.transferOut) message += `\n- Transfer volta: ${formatCurrency(getExtraPrice('transfer_departure'))}`;
        message += `\n\nüíµ Total: ${formatCurrency(total)}\n\nObrigado!`;
        window.open(`https://wa.me/5521997305179?text=${encodeURIComponent(message)}`, '_blank');
      });

      updatePriceUI();
    });
  }

  /* ================= Hero autoplay & handlers ================= */
  (function heroCycle(){
    const slides = qsa('.hero-slide'); const indicators = qs('#heroIndicators'); let idx=0, paused=false, timer=null;
    function renderIndicators(){ if(!indicators) return; indicators.innerHTML = slides.map((_,i)=>`<button data-i="${i}" class="${i===idx?'active':''}"></button>`).join(''); indicators.querySelectorAll('button').forEach(b=>b.addEventListener('click', ()=> { idx = Number(b.dataset.i); update(); reset(); })); }
    function update(){ slides.forEach((s,i)=> s.classList.toggle('active', i===idx)); renderIndicators(); }
    function next(){ idx = (idx+1) % slides.length; update(); }
    function prev(){ idx = (idx-1+slides.length) % slides.length; update(); }
    function reset(){ if (timer) clearInterval(timer); timer = setInterval(()=>{ if (!paused) next(); }, 5000); }
    qs('#heroNext').addEventListener('click', ()=> { next(); reset(); });
    qs('#heroPrev').addEventListener('click', ()=> { prev(); reset(); });
    qs('#hero').addEventListener('mouseenter', ()=> paused = true);
    qs('#hero').addEventListener('mouseleave', ()=> paused = false);
    qs('#toReservationBtn').addEventListener('click', ()=> qs('#reservationSection').scrollIntoView({behavior:'smooth'}));
    qs('#toRoomsBtn').addEventListener('click', ()=> qs('#roomsSection').scrollIntoView({behavior:'smooth'}));
    renderIndicators(); update(); reset();
  })();

  /* ================= Boot sequence ================= */
  function renderAll(){ renderBenefits(); renderTestimonials(); renderRoomsGrid(); renderReservationCards(); }
  (function init(){ document.documentElement.lang='pt-BR'; document.documentElement.setAttribute('translate','no'); document.documentElement.classList.add('notranslate'); renderAll(); loadSheets(); })();

  </script>
</body>
</html>